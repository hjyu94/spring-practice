<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="/js/jquery-form.js"></script>
</head>
<body>
<h1>파일 업로드 - form 방식</h1>
<form id="form1" th:action="@{/uploadForm}" method="post" enctype="multipart/form-data">
    <input type="file" name="file" />
    <input type="submit" />
</form>
savedFilename: <th:block th:text="${savedFileName}"></th:block>
<hr/>

<h1>파일 업로드 - ajax 방식</h1>
<form id="form2" th:action="@{/uploadAjax}" method="post" enctype="multipart/form-data">
    <input type="file" name="file" id="ajax-file"/>
    <input type="submit" value="ajax 로 호출"/>
</form>
<div id="percent">0%</div>
<div id="status">ready</div>
AJAX-savedFilename: <span id="upfile"></span>

<script>
    const $percent = $('#percent'),
        $status = $('#status');

    $("#form2").ajaxForm({
        beforeSend: function() {
            let f = $("#ajax-file").val();
            console.debug("beforeSend!!", f);
            if(!f) return false;
            $status.empty();
            var percentVal = "0%";
            $percent.html(percentVal);
        },
        uploadProgress: function(event, position, total, percentComplete) {
            console.debug("progress...");
            $status.html('uploading...');
            $percent.html(percentComplete + '%');
        },
        complete: function(xhr) {
            console.debug("xhr.responseText>>", xhr.responseText)
            $("#upfile").html(xhr.responseText);
        }
    });
</script>
</body>
</html>